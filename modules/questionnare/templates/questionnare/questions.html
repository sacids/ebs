{% extends 'frontend/base.html' %}
{% load i18n %}
{% load static %}
{% load ebs_tags %}
{% block title %} EBS - Questionnare {% endblock %}

{% block content %}

{% include 'frontend/menu.html' %}
<!-- Page content -->
<div class="page-content bg-grey">
    <div class="container">
        <!-- Main content -->
        <div class="content-wrapper">
            <!-- Content area -->
            <div class="content" id="section-data">
                {% if messages %}
                <div class="row mt-2">
                    <div class="col-md-12">
                        <div class="alert alert-danger">
                            <a class="close" href="#" data-dismiss="alert">Ã—</a>
                            {% for message in messages %}
                            <p>{{ message }}</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <form id="msform" action="" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <fieldset>
                        <div class="card-h1 mt-2">
                            <div class="col-md-12">
                                <h5 class="font-weight-600">
                                    {{ section.title }}
                                </h5>
                                <span>{% trans 'Section' %} {{ section.code }} {% trans 'of' %} {{ survey.sections.count }}</span>
                            </div>
                            <!--./col-->
                        </div>
                        <!--./row-->

                        {% for question in questions %}
                        {% if question.has_sub == "NO" and question.parent == None %}
                            <!--start-->
                            <div class="form-card">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>{{ question.code|str_title:question.title }}</label>
                                            {% if question.hints != null %}
                                            <p class="small">
                                                {{ question.hints }}
                                            </p>
                                            {% endif %}
                                        </div>
                                        <!--./form-group-->
                                    </div>
                                    <!--./col-->
                                </div>
                                <!--./row-->

                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            {% if question.qn_type == 'RADIO' %}
                                                <input id="answer" name="answer[{{question.id}}]" type="radio" class="" value="YES" {% if question.id|get_qn_answer:user == "YES" %} checked {% endif %} />
                                                <label for="answer" class="">&nbsp;{% trans 'Yes' %}</label>
                                                <br />
                                                <input id="answer" name="answer[{{question.id}}]" type="radio" class="" value="NO" {% if question.id|get_qn_answer:user == "NO" %} checked {% endif %} />
                                                <label for="answer" class="">&nbsp;{% trans 'No' %}</label>
                                            {% elif question.qn_type == 'TEXT' %}
                                                <input type="text" name="answer[{{question.id}}]" id="answer" value="{{ question.id|get_qn_answer:user }}" class="form-control" />
                                            {% elif question.qn_type == 'NUMBER' %}
                                                <input type="number" name="answer[{{question.id}}]" id="answer" value="{{ question.id|get_qn_answer:user }}" class="form-control" />
                                            {% elif question.qn_type == 'DATE' %}
                                                <input type="date" name="answer[{{question.id}}]" id="answer" value="{{ question.id|get_qn_answer:user }}" class="form-control" />
                                            {% elif question.qn_type == 'TEXTAREA' %}
                                                <textarea rows="4" cols="40" name="answer[{{question.id}}]" class="textarea form-control"
                                                id="answer">{{ question.id|get_qn_answer:user }}</textarea>         
                                            {% elif question.qn_type == 'ATTACHMENT' %}
                                                <input type="hidden" name="answer[{{question.id}}]" id="answer" value="{{ question.id|get_qn_answer:user }}" class="form-control" />
                                                <input type="file" name="attachments[{{question.id}}]" class="form-control" multiple />
                                                {% show_attachments question.id user %}
                                            {% endif %}
                                        </div>
                                    </div>
                                    <!--./col-->

                                    {% if question.has_upload == 'YES' %}
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label>{% trans 'Attachments' %}</label>
                                                <input type="hidden" name="answer[{{question.id}}]" id="answer" value="{{ question.id|get_qn_answer:user }}" class="form-control" />
                                                <input type="file" name="attachments[{{question.id}}]" class="form-control" multiple />
                                                {% show_attachments question.id user %}
                                            </div>
                                        </div>
                                        <!--./col-->
                                    {% endif %}

                                    {% if question.has_remarks == 'YES' %}
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label>{% trans 'Remarks' %}</label>
                                                <textarea rows="3" cols="40" name="remarks[{{question.id}}]" class="form-control"
                                                    placeholder="{% trans 'Write remarks...' %}"
                                                    id="remarks">{{ question.id|get_qn_remarks:user }}</textarea>
                                            </div>
                                        </div>
                                        <!--./col-->
                                    {% endif %}
                                </div>
                                <!--./row-->
                            </div>
                            <!--./form-card-->
                        {% elif question.has_sub == "LEVEL1" %}
                            <!--start-->
                            <div class="form-card">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>{{ question.code|str_title:question.title }}</label>
                                            {% if question.hints != null %}
                                            <p class="small">
                                                {{ question.hints }}
                                            </p>
                                            {% endif %}
                                        </div>
                                        <!--./form-group-->
                                    </div>
                                    <!--./col-->
                                </div>
                                <!--./row-->
                            </div>
                            <!--./form-card-->

                            <!--start-->
                            <div class="form-card">
                            {% for sub_qn in question.sub_questions.all %}
                            {% if sub_qn.has_sub == "NO" and parent == None %}
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>{{ sub_qn.code|str_title:sub_qn.title }}</label>
                                            {% if sub_qn.hints != null %}
                                            <p class="small">
                                                {{ sub_qn.hints }}
                                            </p>
                                            {% endif %}
                                        </div>
                                        <!--./form-group-->
                                    </div>
                                    <!--./col-->
                                </div>
                                <!--./row-->
                                
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            {% if sub_qn.qn_type == 'RADIO' %}
                                                <input id="answer" name="answer[{{sub_qn.id}}]" type="radio" class="" value="YES" {% if sub_qn.id|get_qn_answer:user == "YES" %} checked {% endif %} />
                                                <label for="answer" class="">&nbsp;{% trans 'Yes' %}</label>
                                                <br />
                                                <input id="answer" name="answer[{{sub_qn.id}}]" type="radio" class="" value="NO" {% if sub_qn.id|get_qn_answer:user == "NO" %} checked {% endif %} />
                                                <label for="answer" class="">&nbsp;{% trans 'No' %}</label>
                                            {% elif sub_qn.qn_type == 'TEXT' %}
                                                <input type="text" name="answer[{{sub_qn.id}}]" id="answer" value="{{ sub_qn.id|get_qn_answer:user }}" class="form-control" />
                                            {% elif sub_qn.qn_type == 'NUMBER' %}
                                                <input type="number" name="answer[{{sub_qn.id}}]" id="answer" value="{{ sub_qn.id|get_qn_answer:user }}" class="form-control" />
                                            {% elif sub_qn.qn_type == 'DATE' %}
                                                <input type="date" name="answer[{{sub_qn.id}}]" id="answer" value="{{ sub_qn.id|get_qn_answer:user }}" class="form-control" />
                                            {% elif sub_qn.qn_type == 'TEXTAREA' %}
                                                <textarea rows="4" cols="40" name="answer[{{sub_qn.id}}]" class="textarea form-control"
                                                id="answer">{{ sub_qn.id|get_qn_answer:user }}</textarea>         
                                            {% elif sub_qn.qn_type == 'ATTACHMENT' %}
                                                <input type="hidden" name="answer[{{sub_qn.id}}]" id="answer" value="{{ sub_qn.id|get_qn_answer:user }}" class="form-control" />
                                                <input type="file" name="attachments[{{sub_qn.id}}]" class="form-control" multiple />
                                                {% show_attachments sub_qn.id user %}
                                            {% endif %}
                                        </div>
                                    </div>
                                    <!--./col-->

                                    {% if sub_qn.has_upload == 'YES' %}
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label>{% trans 'Attachments' %}</label>
                                                <input type="hidden" name="answer[{{sub_qn.id}}]" id="answer" value="{{ sub_qn.id|get_qn_answer:user }}" class="form-control" />
                                                <input type="file" name="attachments[{{sub_qn.id}}]" class="form-control" multiple />
                                                {% show_attachments sub_qn.id user %}
                                            </div>
                                        </div>
                                        <!--./col-->
                                    {% endif %}

                                    {% if sub_qn.has_remarks == 'YES' %}
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label>{% trans 'Remarks' %}</label>
                                                <textarea rows="3" cols="40" name="remarks[{{sub_qn.id}}]" class="form-control"
                                                    placeholder="{% trans 'Write remarks...' %}"
                                                    id="remarks">{{ sub_qn.id|get_qn_remarks:user }}</textarea>
                                            </div>
                                        </div>
                                        <!--./col-->
                                    {% endif %}
                                </div>
                                <!--./row-->
                            {% elif question.has_sub == "LEVEL2" %}
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label>{{ sub_qn.code|str_title:sub_qn.title }}</label>
                                        {% if sub_qn.hints != null %}
                                        <p class="small">
                                            {{ sub_qn.hints }}
                                        </p>
                                        {% endif %}
                                    </div>
                                    <!--./form-group-->
                                </div>
                                <!--./col-->
                            </div>
                            <!--./row-->
                            {% for sub_qn_2 in sub_qn.sub_questions.all %}
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>{{ sub_qn2.code|str_title:sub_qn2.title }}</label>
                                            {% if sub_qn.hints != null %}
                                            <p class="small">
                                                {{ sub_qn2.hints }}
                                            </p>
                                            {% endif %}
                                        </div>
                                        <!--./form-group-->
                                    </div>
                                    <!--./col-->
                                </div>
                                <!--./row-->
                                
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            {% if sub_qn2.qn_type == 'RADIO' %}
                                                <input id="answer" name="answer[{{sub_qn2.id}}]" type="radio" class="" value="YES" {% if sub_qn2.id|get_qn_answer:user == "YES" %} checked {% endif %} />
                                                <label for="answer" class="">&nbsp;{% trans 'Yes' %}</label>
                                                <br />
                                                <input id="answer" name="answer[{{sub_qn2.id}}]" type="radio" class="" value="NO" {% if sub_qn2.id|get_qn_answer:user == "NO" %} checked {% endif %} />
                                                <label for="answer" class="">&nbsp;{% trans 'No' %}</label>
                                            {% elif sub_qn.qn_type == 'TEXT' %}
                                                <input type="text" name="answer[{{sub_qn2.id}}]" id="answer" value="{{ sub_qn2.id|get_qn_answer:user }}" class="form-control" />
                                            {% elif sub_qn.qn_type == 'NUMBER' %}
                                                <input type="number" name="answer[{{sub_qn2.id}}]" id="answer" value="{{ sub_qn2.id|get_qn_answer:user }}" class="form-control" />
                                            {% elif sub_qn.qn_type == 'DATE' %}
                                                <input type="date" name="answer[{{sub_qn2.id}}]" id="answer" value="{{ sub_qn2.id|get_qn_answer:user }}" class="form-control" />
                                            {% elif sub_qn.qn_type == 'TEXTAREA' %}
                                                <textarea rows="4" cols="40" name="answer[{{sub_qn2.id}}]" class="textarea form-control"
                                                id="answer">{{ sub_qn2.id|get_qn_answer:user }}</textarea>         
                                            {% elif sub_qn.qn_type == 'ATTACHMENT' %}
                                                <input type="hidden" name="answer[{{sub_qn2.id}}]" id="answer" value="{{ sub_qn2.id|get_qn_answer:user }}" class="form-control" />
                                                <input type="file" name="attachments[{{sub_qn2.id}}]" class="form-control" multiple />
                                                {% show_attachments sub_qn2.id user %}
                                            {% endif %}
                                        </div>
                                    </div>
                                    <!--./col-->

                                    {% if sub_qn2.has_upload == 'YES' %}
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label>{% trans 'Attachments' %}</label>
                                                <input type="hidden" name="answer[{{sub_qn2.id}}]" id="answer" value="{{ sub_qn2.id|get_qn_answer:user }}" class="form-control" />
                                                <input type="file" name="attachments[{{sub_qn2.id}}]" class="form-control" multiple />
                                                {% show_attachments sub_qn2.id user %}
                                            </div>
                                        </div>
                                        <!--./col-->
                                    {% endif %}

                                    {% if sub_qn2.has_remarks == 'YES' %}
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label>{% trans 'Remarks' %}</label>
                                                <textarea rows="3" cols="40" name="remarks[{{sub_qn2.id}}]" class="form-control"
                                                    placeholder="{% trans 'Write remarks...' %}"
                                                    id="remarks">{{ sub_qn2.id|get_qn_remarks:user }}</textarea>
                                            </div>
                                        </div>
                                        <!--./col-->
                                    {% endif %}
                                </div>
                                <!--./row-->
                            {% endfor %}
                            {% endif %}
                            {% endfor %}
                            </div>
                            <!--./form-card-->
                            {% endif %}
                        {% endfor %}

                        <div class="row mt-2 mb-4">
                            <div class="col-md-12">
                                <a href="#" class="btn btn-danger btn-xs pr-2 pl-2">
                                    <i class="fa fa-angle-left"></i> {% trans 'Previous' %}
                                </a>

                                <input type="submit" name="post_exit" class="btn btn-secondary btn-xs pr-2 pl-2"
                                    value="{% trans 'Save and Exit' %}" />
                                {% if section.code < survey.sections.count %}
                                    <input type="submit" name="post_next" class="btn btn-primary btn-xs pr-2 pl-2"
                                        value="{% trans 'Save and Next' %}" />
                                {% elif section.code == survey.sections.count %}
                                    <input type="submit" name="post_next" class="btn btn-primary btn-xs pr-2 pl-2"
                                        value="{% trans 'Save and Complete' %}" />
                                {% endif %}

                                <button class="btn btn-success btn-xs pr-2 pl-2" onclick="printDiv('section-data');">
                                    <i class="fa fa-print"></i> {% trans 'Print/Save' %}
                                </button>
                            </div>
                            <!--./col-->
                        </div>
                        <!--./row-->
                    </fieldset>
                </form>
            </div><!-- /content area -->
        </div><!-- /main content -->
    </div>
    <!--./container-->
</div><!-- /page content -->

{% endblock %}